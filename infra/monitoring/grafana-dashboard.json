{
  "title": "Spoken English Coach â€” Backend",
  "uid": "spoken-english-coach",
  "schemaVersion": 39,
  "refresh": "30s",
  "time": { "from": "now-1h", "to": "now" },
  "panels": [
    {
      "id": 1, "type": "stat", "title": "Request Rate (req/s)",
      "gridPos": { "x": 0, "y": 0, "w": 6, "h": 4 },
      "targets": [{
        "expr": "sum(rate(http_requests_total[1m]))",
        "legendFormat": "req/s"
      }],
      "options": { "colorMode": "background", "graphMode": "area" }
    },
    {
      "id": 2, "type": "stat", "title": "Error Rate (%)",
      "gridPos": { "x": 6, "y": 0, "w": 6, "h": 4 },
      "targets": [{
        "expr": "100 * sum(rate(http_requests_total{status=~\"5..\"}[1m])) / sum(rate(http_requests_total[1m]))",
        "legendFormat": "5xx %"
      }],
      "fieldConfig": { "defaults": { "thresholds": {
        "steps": [{"color":"green","value":0},{"color":"yellow","value":1},{"color":"red","value":5}]
      }}}
    },
    {
      "id": 3, "type": "stat", "title": "ASR p95 Latency (s)",
      "gridPos": { "x": 12, "y": 0, "w": 6, "h": 4 },
      "targets": [{
        "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{handler=~\".*/asr.*\"}[5m])) by (le))",
        "legendFormat": "p95"
      }]
    },
    {
      "id": 4, "type": "stat", "title": "TTS p95 Latency (s)",
      "gridPos": { "x": 18, "y": 0, "w": 6, "h": 4 },
      "targets": [{
        "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{handler=~\".*/tts.*\"}[5m])) by (le))",
        "legendFormat": "p95"
      }]
    },
    {
      "id": 5, "type": "timeseries", "title": "Request Volume by Endpoint",
      "gridPos": { "x": 0, "y": 4, "w": 24, "h": 8 },
      "targets": [{
        "expr": "sum by (handler) (rate(http_requests_total[1m]))",
        "legendFormat": "{{ handler }}"
      }],
      "options": { "tooltip": { "mode": "multi" } }
    },
    {
      "id": 6, "type": "timeseries", "title": "Response Time Percentiles (all endpoints)",
      "gridPos": { "x": 0, "y": 12, "w": 12, "h": 8 },
      "targets": [
        { "expr": "histogram_quantile(0.50, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))", "legendFormat": "p50" },
        { "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))", "legendFormat": "p95" },
        { "expr": "histogram_quantile(0.99, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))", "legendFormat": "p99" }
      ]
    },
    {
      "id": 7, "type": "timeseries", "title": "Coaching Sessions / min",
      "gridPos": { "x": 12, "y": 12, "w": 12, "h": 8 },
      "targets": [{
        "expr": "sum(rate(http_requests_total{handler=~\".*/coach\",method=\"POST\",status=\"200\"}[1m])) * 60",
        "legendFormat": "sessions/min"
      }]
    }
  ]
}
